// Generated by CoffeeScript 1.6.2
(function() {
  var Game;

  Game = (function() {
    function Game(player, turn, playerToken) {
      this.player = player != null ? player : "player1";
      this.turn = turn != null ? turn : "player";
      this.playerToken = playerToken != null ? playerToken : "X";
      this.moveCount = 0;
      this.board = [" ", " ", " ", " ", " ", " ", " ", " ", " "];
      this.gameOver = false;
      if (this.playerToken === "X") {
        this.computerToken = "O";
      } else {
        this.computerToken = "X";
      }
      this.ai = new Computer(this.computerToken, this.playerToken);
    }

    Game.prototype.playerMove = function(position) {
      if (this.checkLocation(position) === " " && this.turn === "player") {
        this.moveCount++;
        this.board[position] = this.playerToken;
        if (this.checkIfWon(this.playerToken)) {
          this.playerWon();
          this.gameOver = true;
        }
        if (this.moveCount === 9) {
          return this.nobodyWon();
        }
        return this.changeTurn();
      }
    };

    Game.prototype.checkLocation = function(position) {
      return this.board[position];
    };

    Game.prototype.computerMove = function() {
      var position;

      position = this.computerLogic();
      if (this.checkLocation(position) === " " && this.turn === "computer") {
        this.moveCount++;
        this.board[position] = this.computerToken;
        if (this.checkIfWon(this.computerToken)) {
          this.computerWon();
          this.gameOver = true;
        }
        if (this.moveCount === 9) {
          return this.nobodyWon();
        }
        return this.changeTurn();
      }
    };

    Game.prototype.changeTurn = function() {
      return this.turn = this.turn === "player" ? "computer" : "player";
    };

    Game.prototype.computerLogic = function() {
      return this.ai.gameLogic(this.board)[0];
    };

    Game.prototype.winnerAlert = function(who) {
      return alert("" + who + " has won this round");
    };

    Game.prototype.checkIfWon = function(token) {
      var combos, _i, _len, _ref;

      _ref = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        combos = _ref[_i];
        if (this.ai.checkSpaces(combos, token, this.board).length === 3) {
          return true;
        }
      }
      if (this.moveCount === 9) {
        this.gameOver = true;
      }
      return false;
    };

    Game.prototype.playerWon = function() {
      return this.winnerAlert(this.player.name);
    };

    Game.prototype.computerWon = function() {
      return this.winnerAlert("computer");
    };

    Game.prototype.nobodyWon = function() {
      return this.winnerAlert("DRAW: nobody");
    };

    return Game;

  })();

  window.Game = Game;

}).call(this);
